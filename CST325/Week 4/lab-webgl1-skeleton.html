<html>

<head>
<title>Introduction to WebGL Lab</title>

<script src="vector3.js"></script>
<script src="matrix4.js"></script>

<script type="text/javascript">

    // the main variable through which we will interact with webgl
    var gl;

    // we preallocate our matrix objects here and reuse them every frame
    var viewMatrix = new Matrix4();
    var projectionMatrix = new Matrix4();

    // the shader that will be used by each piece of geometry (they could each use their own shader but in this case it will be the same)
    var shaderProgram;

    // -------------------------------------------------------------------------
    function initializeAndStartRendering() {
        initGL();
        updateAndRender();
    }

    // -------------------------------------------------------------------------
    // Get a valid link to the GL "context"
    function initGL(canvas) {
        var canvas = document.getElementById("webgl-canvas");

        try {
            gl = canvas.getContext("webgl");
        } catch (e) {}

        if (!gl) {
            alert("Could not initialise WebGL, sorry :-(");
        }
    }


    function createShaders() {
        // Get the objects representing individual shaders

        // todo get access to the shader source code text and compile
        var vertexShaderText = document.getElementById("webgl-canvas").textContent;
        var vertexShader = createCompiledShader(vertexShaderText, gl.VERTEX_SHADER);

        var fragmentShaderText = document.getElementById("webgl-canvas").textContent;
        var fragmentShader = createCompiledShader(fragmentShaderText, gl.FRAGMENT_SHADER);
    }



    function createCompiledShader(shaderText, shaderType) {
        var shader = gl.createShader(shaderType);

        gl.shaderSource(shader, shaderText);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(shader));
            console.log(gl.getShaderInfoLog(shader));
            return null;
        }
        return shader;
    }



    // -------------------------------------------------------------------------
    function updateAndRender() {
        requestAnimationFrame(updateAndRender);

        gl.viewport(0, 0, 1024, 768);

        gl.clearColor(0.707, 0.707, 1, 1.0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    }

</script>

</head>


<body onload="initializeAndStartRendering();">
    <canvas id="webgl-canvas" style="border: none;" width="1024" height="768"></canvas>
</body>

</html>
